{% extends 'base.html' %}

{% block content %}
<div class="battle-screen">
    <!-- Question Header -->
    <div class="question-header">
        <p class="question-text">{{ game_state.question }}</p>
    </div>
    <!-- Bot Section -->
    <div class="bot-area">
        <div class="bot-info">
            <div class="bot-dialog">
                <p>{{ game_state.bot_type_name }}</p>
                {% if game_state.bot_log %}
                    <p>{{ game_state.bot_log[-1] }}</p>
                {% endif %}
            </div>
            <div class="bot-stats">
                <div class="health-bar">
                    <div class="health-progress" style="width: {{ (game_state.bot_capital / 10000) * 100 }}%"></div>
                </div>
                <p>HP: {{ game_state.bot_capital }}/10000</p>
            </div>
        </div>
        <div class="bot-avatar">
            <img src="{{ url_for('static', filename='images/bots/' + game_state.bot_type_name.lower() + '.png') }}" 
                 alt="{{ game_state.bot_type_name }}">
        </div>
    </div>

    <!-- Width Reduction Bar -->
    <div class="width-bar-container">
        <div class="width-bar">
            {% if game_state.initial_width %}
            <div class="width-progress" style="width: {{ (game_state.current_width / game_state.initial_width) * 100 }}%"></div>
            {% endif %}
        </div>
    </div>

    <!-- Player Section -->
    <div class="player-area">
        <div class="player-avatar">
            <img src="{{ url_for('static', filename='images/player.png') }}" alt="Player">
        </div>
        <div class="player-controls">
            <!-- Player Health -->
            <div class="health-container">
                <div class="health-bar">
                    <div class="health-progress" style="width: {{ (game_state.player_capital / 10000) * 100 }}%"></div>
                </div>
                <p>HP: {{ game_state.player_capital }}/10000</p>
            </div>

            <!-- Game Controls -->
            {% if show_initial_width_form %}
            <div class="action-buttons">
                <form method="post">
                    <input type="number" name="initial_width" placeholder="Enter initial width" required>
                    <button type="submit" class="action-button">Set Width</button>
                </form>
            </div>
            {% elif show_reduce_width_option %}
            <div class="action-buttons">
                <form method="post">
                    <select name="action" class="action-select">
                        <option value="reduce_width">Reduce Width</option>
                        <option value="make_market">Make Market</option>
                    </select>
                    <input type="number" name="width" placeholder="New width">
                    <button type="submit" class="action-button">Submit</button>
                </form>
            </div>
            {% elif game_state.market_made %}
            <div class="action-buttons">
                <form method="post">
                    <input type="hidden" name="action" value="trade">
                    <button type="submit" name="trade_action" value="buy" class="action-button">Buy at {{ game_state.ask }}</button>
                    <button type="submit" name="trade_action" value="sell" class="action-button">Sell at {{ game_state.bid }}</button>
                </form>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
